(()=>{var l=()=>!!window.subscribe&&!!PUB_SUB_EVENTS&&!!PUB_SUB_EVENTS.variantChange,h=()=>{let a=()=>{let e=new URL(document.URL).searchParams.get("variant");e&&e!==(void 0).productVariantId&&(void 0).handleVariantChange((void 0).sectionId,{id:e})};return document.addEventListener("change",a),()=>{document.removeEventListener("change",a)}},u=(a,t)=>[a,`ProductForm-${t}`].find(e=>!!document.getElementById(e)),n=class extends HTMLElement{constructor(){super(),this.sectionId=this.dataset.sectionId,this.productVariantId=this.dataset.productVariantId,this.sellingPlanId=this.dataset.sellingPlanId,this.defaultProductFormId=this.dataset.defaultProductFormId}variantChangeUnsubscriber=void 0;connectedCallback(){document.addEventListener("DOMContentLoaded",()=>{this.subscribeToVariantChange()}),this.addEventListener("change",t=>{t.target.name==="selling_plan"&&this.handleSellingPlanChange(this.sectionId,{id:t.target.value})}),this.updateUrl(),this.updateProductFormId()}disconnectedCallback(){this.variantChangeUnsubscriber&&this.variantChangeUnsubscriber()}subscribeToVariantChange(){l()?this.variantChangeUnsubscriber=subscribe(PUB_SUB_EVENTS.variantChange,t=>{this.handleVariantChange(t.data.sectionId,t.data.variant)}):this.variantChangeUnsubscriber=h((t,e)=>{this.handleVariantChange(t,{id:e})})}handleVariantChange(t,e){t===this.sectionId&&(this.productVariantId=e.id,this.updateUrl(),this.updateComponent())}handleSellingPlanChange(t,e){t===this.sectionId&&(this.sellingPlanId=e.id,this.updateUrl(),this.updateComponent())}updateUrl(){let t=new URLSearchParams(window.location.search);if(t.get("selling_plan")||this.sellingPlanId){t.set("selling_plan",this.sellingPlanId);let e=`${window.location.pathname}?${t.toString()}`;window.history.replaceState(null,"",e)}}updateComponent(){let t=new URLSearchParams(window.location.search);t.set("section_id",this.sectionId),t.set("variant",this.productVariantId),t.set("selling_plan",this.sellingPlanId);let e=`${window.location.pathname}?${t.toString()}`;fetch(e).then(async o=>{let d=await o.text(),c=new DOMParser().parseFromString(d,"text/html").querySelector(`${this.tagName}[data-section-id="${this.sectionId}"]`);this.innerHTML=c.innerHTML,this.updateProductFormId()})}updateProductFormId(){let t=u(this.defaultProductFormId,this.sectionId);t!==this.defaultProductFormId&&this.querySelectorAll(`input[form="${this.defaultProductFormId}"]`).forEach(e=>{e.setAttribute("form",t)})}};var s=class extends n{};var i=class extends n{};var r=class extends n{};customElements.get("crowdfunding-selector")||customElements.define("crowdfunding-selector",s);customElements.get("presale-selector")||customElements.define("presale-selector",i);customElements.get("subscription-selector")||customElements.define("subscription-selector",r);})();
