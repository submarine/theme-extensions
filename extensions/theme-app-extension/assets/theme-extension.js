(()=>{var l=n=>{let t=()=>{let s=new URL(document.URL).searchParams.get("variant");s&&s!==n.productVariantId&&n.handleVariantChange(n.sectionId,{id:s})};return document.addEventListener("change",t),()=>{document.removeEventListener("change",t)}},u=(n,t,e)=>[n,`ProductForm-${t}`,`AddToCartForm-${e}`].find(s=>!!document.getElementById(s)),a=class extends HTMLElement{constructor(){super(),this.sectionId=this.dataset.sectionId,this.productId=this.dataset.productId,this.productVariantId=this.dataset.productVariantId,this.sellingPlanId=this.dataset.sellingPlanId,this.defaultProductFormId=this.dataset.defaultProductFormId}variantChangeUnsubscriber=void 0;connectedCallback(){document.addEventListener("DOMContentLoaded",()=>{this.subscribeToVariantChange()}),this.addEventListener("change",t=>{t.target.name==="selling_plan"&&this.handleSellingPlanChange(this.sectionId,{id:t.target.value})}),this.updateUrl(),this.updateProductFormId()}disconnectedCallback(){this.variantChangeUnsubscriber&&this.variantChangeUnsubscriber()}subscribeToVariantChange(){this.variantChangeUnsubscriber=l(this)}handleVariantChange(t,e){t===this.sectionId&&(this.productVariantId=e.id,this.updateUrl(),this.updateComponent())}handleSellingPlanChange(t,e){t===this.sectionId&&(this.sellingPlanId=e.id,this.updateUrl(),this.updateComponent())}updateUrl(){let t=new URLSearchParams(window.location.search);if(t.get("selling_plan")||this.sellingPlanId){t.set("selling_plan",this.sellingPlanId);let e=`${window.location.pathname}?${t.toString()}`;window.history.replaceState(null,"",e)}}updateComponent(){let t=new URLSearchParams(window.location.search);t.set("section_id",this.sectionId),t.set("variant",this.productVariantId),t.set("selling_plan",this.sellingPlanId);let e=`${window.location.pathname}?${t.toString()}`;fetch(e).then(async s=>{let d=await s.text(),c=new DOMParser().parseFromString(d,"text/html").querySelector(`${this.tagName}[data-section-id="${this.sectionId}"]`);this.innerHTML=c.innerHTML,this.updateProductFormId()})}updateProductFormId(){let t=u(this.defaultProductFormId,this.sectionId,this.productId);t!==this.defaultProductFormId&&this.querySelectorAll(`input[form="${this.defaultProductFormId}"]`).forEach(e=>{t===void 0?e.removeAttribute("form"):e.setAttribute("form",t)})}};var r=class extends a{};var i=class extends a{};var o=class extends a{};customElements.get("crowdfunding-selector")||customElements.define("crowdfunding-selector",r);customElements.get("presale-selector")||customElements.define("presale-selector",i);customElements.get("subscription-selector")||customElements.define("subscription-selector",o);})();
